<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Coletor H√≠brido de Leads</title>
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }

      .container {
          max-width: 1400px;
          margin: 0 auto;
          background: white;
          border-radius: 15px;
          box-shadow: 0 20px 40px rgba(0,0,0,0.1);
          overflow: hidden;
      }

      .header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          padding: 30px;
          text-align: center;
      }

      .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
      }

      .header p {
          font-size: 1.1em;
          opacity: 0.9;
      }

      .nav-links {
          margin-top: 20px;
      }

      .nav-link {
          color: white;
          text-decoration: none;
          padding: 10px 20px;
          margin: 0 10px;
          border-radius: 25px;
          transition: all 0.3s;
          background: rgba(255,255,255,0.1);
      }

      .nav-link:hover {
          background: rgba(255,255,255,0.2);
          transform: translateY(-2px);
      }

      .nav-link.active {
          background: rgba(255,255,255,0.3);
          font-weight: bold;
      }

      .content {
          padding: 30px;
      }

      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .stat-card {
          background: #f8f9fa;
          padding: 25px;
          border-radius: 10px;
          text-align: center;
          border-left: 4px solid #667eea;
      }

      .stat-card h3 {
          color: #667eea;
          font-size: 2em;
          margin-bottom: 10px;
      }

      .stat-card p {
          color: #666;
          font-size: 1.1em;
      }

      .segments-container {
          background: #f8f9fa;
          padding: 25px;
          border-radius: 10px;
          margin-bottom: 30px;
      }

      .segment-tabs {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          margin-bottom: 20px;
      }

      .segment-tab {
          background: white;
          border: 2px solid #e9ecef;
          padding: 10px 20px;
          border-radius: 25px;
          cursor: pointer;
          transition: all 0.3s;
      }

      .segment-tab:hover {
          border-color: #667eea;
          background: #f0f4ff;
      }

      .segment-tab.active {
          background: #667eea;
          color: white;
          border-color: #667eea;
      }

      .segment-content {
          display: none;
      }

      .segment-content.active {
          display: block;
      }

      .table-container {
          background: white;
          border-radius: 10px;
          overflow: hidden;
          box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }

      .table-header {
          background: #667eea;
          color: white;
          padding: 15px 20px;
          font-weight: bold;
      }

      .table {
          width: 100%;
          border-collapse: collapse;
      }

      .table th {
          background: #f8f9fa;
          padding: 12px;
          text-align: left;
          border-bottom: 2px solid #e9ecef;
          font-weight: 600;
          color: #333;
      }

      .table td {
          padding: 12px;
          border-bottom: 1px solid #e9ecef;
          vertical-align: top;
      }

      .table tr:hover {
          background: #f8f9fa;
      }

      .btn {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 8px;
          font-size: 14px;
          cursor: pointer;
          transition: transform 0.2s;
          margin: 5px;
      }

      .btn:hover {
          transform: translateY(-2px);
      }

      .btn-success {
          background: #28a745;
      }

      .empty-state {
          text-align: center;
          padding: 50px;
          color: #666;
      }

      .empty-state h3 {
          margin-bottom: 15px;
          color: #333;
      }

      .search-history {
          background: #f8f9fa;
          padding: 25px;
          border-radius: 10px;
          margin-bottom: 30px;
      }

      .search-item {
          background: white;
          padding: 15px;
          border-radius: 8px;
          margin-bottom: 15px;
          border-left: 4px solid #667eea;
      }

      .search-item h4 {
          color: #333;
          margin-bottom: 10px;
      }

      .search-meta {
          color: #666;
          font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìä Dashboard de Leads</h1>
        <p>Visualiza√ß√£o organizada de todos os resultados</p>
        <div class="nav-links">
          <a href="/" class="nav-link">üîç Nova Busca</a>
          <a href="/dashboard" class="nav-link active">üìä Dashboard</a>
        </div>
      </div>

      <div class="content">
        <!-- Estat√≠sticas Gerais -->
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="totalSearches">0</h3>
            <p>Total de Buscas</p>
          </div>
          <div class="stat-card">
            <h3 id="totalLeads">0</h3>
            <p>Total de Leads</p>
          </div>
          <div class="stat-card">
            <h3 id="totalSegments">0</h3>
            <p>Segmentos Ativos</p>
          </div>
          <div class="stat-card">
            <h3 id="avgLeadsPerSearch">0</h3>
            <p>M√©dia de Leads/Busca</p>
          </div>
        </div>

        <!-- Hist√≥rico de Buscas -->
        <div class="search-history">
          <h2>üìã Hist√≥rico de Buscas</h2>
          <div id="searchHistory">
            <div class="empty-state">
              <h3>Nenhuma busca realizada ainda</h3>
              <p>Fa√ßa sua primeira busca para ver os resultados aqui</p>
            </div>
          </div>
        </div>

        <!-- Segmentos -->
        <div class="segments-container">
          <h2>üìà Resultados por Segmento</h2>
          <div class="segment-tabs" id="segmentTabs">
            <div class="empty-state">
              <h3>Nenhum segmento dispon√≠vel</h3>
              <p>Realize buscas para ver os segmentos organizados</p>
            </div>
          </div>

          <div id="segmentContent">
            <div class="empty-state">
              <h3>Selecione um segmento</h3>
              <p>Escolha um segmento acima para ver os detalhes</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let dashboardData = null;

      // Carregar dados do dashboard
      async function loadDashboardData() {
          try {
              const response = await fetch('/api/dashboard-data');
              dashboardData = await response.json();
              updateDashboard();
          } catch (error) {
              console.error('Erro ao carregar dados:', error);
          }
      }

      function updateDashboard() {
          if (!dashboardData) return;

          // Atualizar estat√≠sticas
          document.getElementById('totalSearches').textContent = dashboardData.searches.length;
          document.getElementById('totalLeads').textContent = dashboardData.total_leads;
          document.getElementById('totalSegments').textContent = Object.keys(dashboardData.segments).length;

          const avgLeads = dashboardData.searches.length > 0
              ? Math.round(dashboardData.total_leads / dashboardData.searches.length)
              : 0;
          document.getElementById('avgLeadsPerSearch').textContent = avgLeads;

          // Atualizar hist√≥rico de buscas
          updateSearchHistory();

          // Atualizar segmentos
          updateSegments();
      }

      function updateSearchHistory() {
          const container = document.getElementById('searchHistory');

          if (dashboardData.searches.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>Nenhuma busca realizada ainda</h3>
                      <p>Fa√ßa sua primeira busca para ver os resultados aqui</p>
                  </div>
              `;
              return;
          }

          container.innerHTML = dashboardData.searches.map(search => `
              <div class="search-item">
                  <h4>${search.nicho} em ${search.cidade}</h4>
                  <div class="search-meta">
                      <strong>Data:</strong> ${search.timestamp} |
                      <strong>Leads encontrados:</strong> ${search.total_results} |
                      <button class="btn btn-success" onclick="viewSegment('${search.nicho} - ${search.cidade}')">
                          Ver Detalhes
                      </button>
                  </div>
              </div>
          `).join('');
      }

      function updateSegments() {
          const tabsContainer = document.getElementById('segmentTabs');
          const segments = Object.keys(dashboardData.segments);

          if (segments.length === 0) {
              tabsContainer.innerHTML = `
                  <div class="empty-state">
                      <h3>Nenhum segmento dispon√≠vel</h3>
                      <p>Realize buscas para ver os segmentos organizados</p>
                  </div>
              `;
              return;
          }

          tabsContainer.innerHTML = segments.map((segmentKey, index) => `
              <div class="segment-tab ${index === 0 ? 'active' : ''}"
                   onclick="showSegment('${segmentKey}')">
                  ${segmentKey} (${dashboardData.segments[segmentKey].total_leads})
              </div>
          `).join('');

          // Mostrar primeiro segmento por padr√£o
          if (segments.length > 0) {
              showSegment(segments[0]);
          }
      }

      function showSegment(segmentKey) {
          // Atualizar tabs ativos
          document.querySelectorAll('.segment-tab').forEach(tab => {
              tab.classList.remove('active');
          });
          event.target.classList.add('active');

          const segment = dashboardData.segments[segmentKey];
          const container = document.getElementById('segmentContent');

          container.innerHTML = `
              <div class="table-container">
                  <div class="table-header">
                      ${segmentKey} - ${segment.total_leads} empresas encontradas
                  </div>
                  <table class="table">
                      <thead>
                          <tr>
                              <th>Empresa</th>
                              <th>Telefone</th>
                              <th>Email</th>
                              <th>Website</th>
                              <th>Endere√ßo</th>
                                                             <th>LinkedIn</th>
                               <th>Facebook</th>
                               <th>WhatsApp</th>
                          </tr>
                      </thead>
                      <tbody>
                          ${segment.companies.map(company => `
                              <tr>
                                  <td><strong>${company.nome || 'N/A'}</strong></td>
                                  <td>${company.telefone || 'N/A'}</td>
                                  <td>${company.email || 'N/A'}</td>
                                  <td>${company.site ? `<a href="${company.site}" target="_blank">${company.site}</a>` : 'N/A'}</td>
                                  <td>${company.endereco || 'N/A'}</td>
                                                                     <td>${company.linkedin || 'N/A'}</td>
                                   <td>${company.facebook || 'N/A'}</td>
                                   <td>${company.whatsapp || 'N/A'}</td>
                              </tr>
                          `).join('')}
                      </tbody>
                  </table>
              </div>
          `;
      }

      function viewSegment(segmentKey) {
          showSegment(segmentKey);
          // Atualizar tab ativo
          document.querySelectorAll('.segment-tab').forEach(tab => {
              tab.classList.remove('active');
              if (tab.textContent.includes(segmentKey)) {
                  tab.classList.add('active');
              }
          });
      }

      // Carregar dados ao iniciar
      loadDashboardData();

      // Atualizar a cada 5 segundos
      setInterval(loadDashboardData, 5000);
    </script>
  </body>
</html>
